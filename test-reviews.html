<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ç–∑—ã–≤–æ–≤ JSONBin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .review-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
        }
        .loading {
            display: none;
            color: blue;
            font-weight: bold;
        }
        .error {
            color: red;
            margin-bottom: 10px;
        }
        .success {
            color: green;
            margin-bottom: 10px;
        }
        #raw-response {
            background-color: #f7f7f7;
            padding: 10px;
            border: 1px solid #ddd;
            max-height: 150px;
            overflow: auto;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            display: none;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .settings {
            background-color: #f9f9f9;
            padding: 15px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
        }
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ JSONBin</h1>
    
    <div id="status-message"></div>
    
    <div class="settings">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div class="form-group checkbox-group">
            <input type="checkbox" id="auto-approve" checked>
            <label for="auto-approve">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è—Ç—å –æ—Ç–∑—ã–≤—ã (status="approved")</label>
        </div>
        <div class="form-group checkbox-group">
            <input type="checkbox" id="clean-structure">
            <label for="clean-structure">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∏—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö</label>
        </div>
    </div>
    
    <h2>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
    <form id="review-form">
        <div class="form-group">
            <label for="name">–í–∞—à–µ –∏–º—è:</label>
            <input type="text" id="name" required>
        </div>
        
        <div class="form-group">
            <label for="rating">–û—Ü–µ–Ω–∫–∞:</label>
            <select id="rating" required>
                <option value="5">5 –∑–≤–µ–∑–¥</option>
                <option value="4">4 –∑–≤–µ–∑–¥—ã</option>
                <option value="3">3 –∑–≤–µ–∑–¥—ã</option>
                <option value="2">2 –∑–≤–µ–∑–¥—ã</option>
                <option value="1">1 –∑–≤–µ–∑–¥–∞</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="service">–£—Å–ª—É–≥–∞:</label>
            <input type="text" id="service" value="–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞">
        </div>
        
        <div class="form-group">
            <label for="status">–°—Ç–∞—Ç—É—Å –æ—Ç–∑—ã–≤–∞:</label>
            <select id="status">
                <option value="approved">–û–¥–æ–±—Ä–µ–Ω (approved)</option>
                <option value="pending">–û–∂–∏–¥–∞–µ—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (pending)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="text">–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞:</label>
            <textarea id="text" rows="5" required></textarea>
        </div>
        
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        <span class="loading" id="submit-loading">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>
    </form>
    
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏</h2>
    <div class="controls">
        <button id="load-reviews">–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–∑—ã–≤—ã</button>
        <button id="test-connection">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
        <button id="init-structure" title="–°–æ–∑–¥–∞—ë—Ç –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ JSONBin, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
        <button id="approve-all" title="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç –¥–ª—è –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤ status=approved">–û–¥–æ–±—Ä–∏—Ç—å –≤—Å–µ –æ—Ç–∑—ã–≤—ã</button>
    </div>
    <span class="loading" id="load-loading">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    
    <div id="raw-response"></div>
    
    <div id="reviews-container">
        <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –æ—Ç–∑—ã–≤—ã -->
    </div>
    
    <script>
        // –ü—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSONBin API
        class SimpleJSONBinAPI {
            constructor(binID, masterKey) {
                this.binID = binID;
                this.masterKey = masterKey;
                this.apiUrl = `https://api.jsonbin.io/v3/b/${binID}`;
                this.initialStructure = {
                    reviews: [],
                    contacts: []
                };
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSONBin
            async getData() {
                try {
                    document.getElementById('load-loading').style.display = 'inline';
                    
                    console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...");
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': this.masterKey
                        }
                    });
                    
                    console.log("–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:", response.status);
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log("–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:", result);
                    
                    document.getElementById('load-loading').style.display = 'none';
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    const rawResponseElem = document.getElementById('raw-response');
                    rawResponseElem.style.display = 'block';
                    rawResponseElem.textContent = JSON.stringify(result, null, 2);
                    
                    // JSONBin –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ { record: { ... } }
                    if (result && result.record) {
                        return result.record;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞
                    if (result) {
                        if (result.reviews !== undefined) {
                            return result;
                        }
                    }
                    
                    return this.initialStructure;
                } catch (error) {
                    document.getElementById('load-loading').style.display = 'none';
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
                    return this.initialStructure;
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ JSONBin
            async saveData(data) {
                try {
                    console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:", data);
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': this.masterKey
                        },
                        body: JSON.stringify(data)
                    });
                    
                    console.log("–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:", response.status);
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
            async initializeStructure() {
                try {
                    // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                    const data = await this.getData();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                    if (document.getElementById('clean-structure').checked) {
                        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ–ø—Ü–∏—è "—á–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞", —Ç–æ —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                        await this.saveData(this.initialStructure);
                        showMessage("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –Ω—É–ª—è!", "success");
                        return this.initialStructure;
                    } else {
                        // –ò–Ω–∞—á–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
                        const updatedData = { 
                            ...data,
                            reviews: Array.isArray(data.reviews) ? data.reviews : [],
                            contacts: Array.isArray(data.contacts) ? data.contacts : []
                        };
                        
                        await this.saveData(updatedData);
                        showMessage("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!", "success");
                        return updatedData;
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // –û–¥–æ–±—Ä–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤
            async approveAllReviews() {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                    const data = await this.getData();
                    
                    // –ï—Å–ª–∏ –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ—Ç, —Å–æ–æ–±—â–∞–µ–º –æ–± —ç—Ç–æ–º
                    if (!data.reviews || data.reviews.length === 0) {
                        showMessage("–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è", "info");
                        return data;
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ–º –æ—Ç–∑—ã–≤–∞–º status="approved"
                    const updatedReviews = data.reviews.map(review => ({
                        ...review,
                        status: "approved"
                    }));
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    const updatedData = {
                        ...data,
                        reviews: updatedReviews
                    };
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await this.saveData(updatedData);
                    showMessage(`–û–¥–æ–±—Ä–µ–Ω–æ ${updatedReviews.length} –æ—Ç–∑—ã–≤–æ–≤!`, "success");
                    
                    return updatedData;
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–æ–≤:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–æ–≤: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            async testConnection() {
                try {
                    document.getElementById('load-loading').style.display = 'inline';
                    showMessage("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...", "info");
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': this.masterKey
                        }
                    });
                    
                    console.log("–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:", response.status);
                    console.log("–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - –∑–∞–≥–æ–ª–æ–≤–∫–∏:", response.headers);
                    
                    document.getElementById('load-loading').style.display = 'none';
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log("–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - –¥–∞–Ω–Ω—ã–µ:", data);
                        
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                        const rawResponseElem = document.getElementById('raw-response');
                        rawResponseElem.style.display = 'block';
                        rawResponseElem.textContent = JSON.stringify(data, null, 2);
                        
                        showMessage("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!", "success");
                        return true;
                    } else {
                        showMessage(`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${response.status} ${response.statusText}`, "error");
                        return false;
                    }
                } catch (error) {
                    document.getElementById('load-loading').style.display = 'none';
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
                    return false;
                }
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
            async addReview(review) {
                try {
                    document.getElementById('submit-loading').style.display = 'inline';
                    
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                    const data = await this.getData();
                    
                    // –°–æ–∑–¥–∞–µ–º ID –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
                    const newId = Date.now().toString(36) + Math.random().toString(36).substr(2);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º ID –∫ –æ—Ç–∑—ã–≤—É
                    const reviewWithId = {
                        ...review,
                        id: newId,
                        timestamp: new Date().toISOString(),
                        likes: 0,
                        dislikes: 0
                    };
                    
                    // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
                    let updatedData = { ...data };
                    if (!updatedData.reviews) {
                        updatedData.reviews = [];
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–∑—ã–≤ –≤ –º–∞—Å—Å–∏–≤
                    updatedData.reviews.push(reviewWithId);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await this.saveData(updatedData);
                    
                    document.getElementById('submit-loading').style.display = 'none';
                    
                    return newId;
                } catch (error) {
                    document.getElementById('submit-loading').style.display = 'none';
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ä–µ–∞–∫—Ü–∏–π (–ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏)
            async updateReaction(reviewId, reactionType) {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                    const data = await this.getData();
                    
                    // –ù–∞—Ö–æ–¥–∏–º –æ—Ç–∑—ã–≤ –ø–æ ID
                    const reviewIndex = data.reviews.findIndex(review => review.id === reviewId);
                    
                    if (reviewIndex === -1) {
                        throw new Error(`–û—Ç–∑—ã–≤ —Å ID ${reviewId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                    }
                    
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ä–µ–∞–∫—Ü–∏–∏
                    const currentValue = data.reviews[reviewIndex][reactionType] || 0;
                    data.reviews[reviewIndex][reactionType] = currentValue + 1;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await this.saveData(data);
                    
                    return data.reviews[reviewIndex][reactionType];
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–∏:", error);
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–∏: ${error.message}`, 'error');
                    throw error;
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º –∫–ª—é—á–∞ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ JSONBin
        const api = new SimpleJSONBinAPI(
            "67d39e6a8561e97a50eb9aab", // Bin ID
            "$2a$10$U.spgA59NgzW9tOTIHK/QekIr4DVVruFGSAw2vXAx1Uuxz5zPnnSe" // Master Key –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        );
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(message, type = 'info') {
            const messageElement = document.getElementById('status-message');
            messageElement.textContent = message;
            messageElement.className = type;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            if (type === 'success') {
                setTimeout(() => {
                    messageElement.textContent = '';
                    messageElement.className = '';
                }, 3000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
        function displayReviews(reviews) {
            const container = document.getElementById('reviews-container');
            container.innerHTML = '';
            
            if (!reviews || reviews.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Ç–∑—ã–≤—ã –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            reviews.sort((a, b) => {
                const dateA = new Date(a.timestamp || a.date || 0);
                const dateB = new Date(b.timestamp || b.date || 0);
                return dateB - dateA;
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∂–¥—ã–π –æ—Ç–∑—ã–≤
            reviews.forEach(review => {
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                let formattedDate = '';
                try {
                    const date = new Date(review.timestamp || review.date);
                    formattedDate = date.toLocaleString();
                } catch (e) {
                    formattedDate = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –¥–∞—Ç–∞';
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
                const statusColor = review.status === 'approved' ? 'green' : (review.status === 'rejected' ? 'red' : 'orange');
                
                reviewCard.innerHTML = `
                    <h3>${review.name}</h3>
                    <p><strong>–î–∞—Ç–∞:</strong> ${formattedDate}</p>
                    <p><strong>–û—Ü–µ–Ω–∫–∞:</strong> ${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}</p>
                    <p><strong>–£—Å–ª—É–≥–∞:</strong> ${review.service}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span style="color:${statusColor}">${review.status || 'pending'}</span></p>
                    <p>${review.text}</p>
                    <div>
                        <button class="like-btn" data-id="${review.id}">üëç –õ–∞–π–∫ (${review.likes || 0})</button>
                        <button class="dislike-btn" data-id="${review.id}">üëé –î–∏–∑–ª–∞–π–∫ (${review.dislikes || 0})</button>
                        <button class="approve-btn" data-id="${review.id}">‚úì –û–¥–æ–±—Ä–∏—Ç—å</button>
                    </div>
                `;
                
                container.appendChild(reviewCard);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤
            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const reviewId = this.getAttribute('data-id');
                    try {
                        const newCount = await api.updateReaction(reviewId, 'likes');
                        this.textContent = `üëç –õ–∞–π–∫ (${newCount})`;
                        showMessage('–õ–∞–π–∫ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ª–∞–π–∫–∞:', error);
                    }
                });
            });
            
            document.querySelectorAll('.dislike-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const reviewId = this.getAttribute('data-id');
                    try {
                        const newCount = await api.updateReaction(reviewId, 'dislikes');
                        this.textContent = `üëé –î–∏–∑–ª–∞–π–∫ (${newCount})`;
                        showMessage('–î–∏–∑–ª–∞–π–∫ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∏–∑–ª–∞–π–∫–∞:', error);
                    }
                });
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–¥–æ–±—Ä–µ–Ω–∏—è
            document.querySelectorAll('.approve-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const reviewId = this.getAttribute('data-id');
                    try {
                        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                        const data = await api.getData();
                        
                        // –ù–∞—Ö–æ–¥–∏–º –æ—Ç–∑—ã–≤ –ø–æ ID
                        const reviewIndex = data.reviews.findIndex(review => review.id === reviewId);
                        
                        if (reviewIndex === -1) {
                            throw new Error(`–û—Ç–∑—ã–≤ —Å ID ${reviewId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                        }
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å "approved"
                        data.reviews[reviewIndex].status = "approved";
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        await api.saveData(data);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        this.previousElementSibling.previousElementSibling.previousElementSibling.innerHTML = 
                            '<strong>–°—Ç–∞—Ç—É—Å:</strong> <span style="color:green">approved</span>';
                            
                        showMessage('–û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –æ–¥–æ–±—Ä–µ–Ω!', 'success');
                        
                        // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π
                        this.disabled = true;
                        this.textContent = "‚úì –û–¥–æ–±—Ä–µ–Ω";
                        
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞:', error);
                        showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞: ${error.message}`, 'error');
                    }
                });
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∑—ã–≤–∞
        document.getElementById('review-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–∑—ã–≤–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —á–µ–∫–±–æ–∫—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è
            let status = document.getElementById('status').value;
            
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ–ø—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å "approved"
            if (document.getElementById('auto-approve').checked) {
                status = "approved";
            }
            
            const reviewData = {
                name: document.getElementById('name').value,
                rating: parseInt(document.getElementById('rating').value),
                service: document.getElementById('service').value,
                text: document.getElementById('text').value,
                date: new Date().toISOString(),
                status: status
            };
            
            try {
                await api.addReview(reviewData);
                showMessage('–û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                this.reset();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤
                const data = await api.getData();
                displayReviews(data.reviews);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–∑—ã–≤–∞:', error);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤
        document.getElementById('load-reviews').addEventListener('click', async function() {
            try {
                const data = await api.getData();
                displayReviews(data.reviews);
                showMessage('–û—Ç–∑—ã–≤—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∑—ã–≤–æ–≤:', error);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        document.getElementById('test-connection').addEventListener('click', async function() {
            await api.testConnection();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        document.getElementById('init-structure').addEventListener('click', async function() {
            try {
                const data = await api.initializeStructure();
                displayReviews(data.reviews);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:', error);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ–¥–æ–±—Ä–µ–Ω–∏—è –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤
        document.getElementById('approve-all').addEventListener('click', async function() {
            try {
                const data = await api.approveAllReviews();
                displayReviews(data.reviews);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–æ–≤:', error);
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ü–∏—é "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è—Ç—å –æ—Ç–∑—ã–≤—ã" –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞
        document.getElementById('status').addEventListener('change', function() {
            if (this.value === 'approved') {
                document.getElementById('auto-approve').checked = true;
            }
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', async function() {
            try {
                await api.testConnection();
                const data = await api.getData();
                displayReviews(data.reviews);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∑—ã–≤–æ–≤:', error);
            }
        });
    </script>
</body>
</html>