<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ç–∑—ã–≤–æ–≤ JSONBin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .review-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
        }
        .loading {
            display: none;
            color: blue;
            font-weight: bold;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ JSONBin</h1>
    
    <div id="status-message"></div>
    
    <h2>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
    <form id="review-form">
        <div class="form-group">
            <label for="name">–í–∞—à–µ –∏–º—è:</label>
            <input type="text" id="name" required>
        </div>
        
        <div class="form-group">
            <label for="rating">–û—Ü–µ–Ω–∫–∞:</label>
            <select id="rating" required>
                <option value="5">5 –∑–≤–µ–∑–¥</option>
                <option value="4">4 –∑–≤–µ–∑–¥—ã</option>
                <option value="3">3 –∑–≤–µ–∑–¥—ã</option>
                <option value="2">2 –∑–≤–µ–∑–¥—ã</option>
                <option value="1">1 –∑–≤–µ–∑–¥–∞</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="service">–£—Å–ª—É–≥–∞:</label>
            <input type="text" id="service" value="–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞">
        </div>
        
        <div class="form-group">
            <label for="text">–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞:</label>
            <textarea id="text" rows="5" required></textarea>
        </div>
        
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        <span class="loading" id="submit-loading">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>
    </form>
    
    <h2>–°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤</h2>
    <button id="load-reviews">–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–∑—ã–≤—ã</button>
    <span class="loading" id="load-loading">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    
    <div id="reviews-container">
        <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –æ—Ç–∑—ã–≤—ã -->
    </div>
    
    <script>
        // –ü—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSONBin API
        class SimpleJSONBinAPI {
            constructor(binID, masterKey) {
                this.binID = binID;
                this.masterKey = masterKey;
                this.apiUrl = `https://api.jsonbin.io/v3/b/${binID}`;
                this.initialStructure = {
                    reviews: [],
                    contacts: []
                };
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSONBin
            async getData() {
                try {
                    document.getElementById('load-loading').style.display = 'inline';
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': this.masterKey
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    document.getElementById('load-loading').style.display = 'none';
                    
                    // JSONBin –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ { record: { ... } }
                    if (result && result.record) {
                        return result.record;
                    }
                    
                    return this.initialStructure;
                } catch (error) {
                    document.getElementById('load-loading').style.display = 'none';
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
                    return this.initialStructure;
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ JSONBin
            async saveData(data) {
                try {
                    const response = await fetch(this.apiUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': this.masterKey
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
            async addReview(review) {
                try {
                    document.getElementById('submit-loading').style.display = 'inline';
                    
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                    const data = await this.getData();
                    
                    // –°–æ–∑–¥–∞–µ–º ID –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
                    const newId = Date.now().toString(36) + Math.random().toString(36).substr(2);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º ID –∫ –æ—Ç–∑—ã–≤—É
                    const reviewWithId = {
                        ...review,
                        id: newId,
                        timestamp: new Date().toISOString(),
                        likes: 0,
                        dislikes: 0,
                        status: "approved"
                    };
                    
                    // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤–∞ –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
                    if (!data.reviews) {
                        data.reviews = [];
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–∑—ã–≤ –≤ –º–∞—Å—Å–∏–≤
                    data.reviews.push(reviewWithId);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await this.saveData(data);
                    
                    document.getElementById('submit-loading').style.display = 'none';
                    
                    return newId;
                } catch (error) {
                    document.getElementById('submit-loading').style.display = 'none';
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ä–µ–∞–∫—Ü–∏–π (–ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏)
            async updateReaction(reviewId, reactionType) {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                    const data = await this.getData();
                    
                    // –ù–∞—Ö–æ–¥–∏–º –æ—Ç–∑—ã–≤ –ø–æ ID
                    const reviewIndex = data.reviews.findIndex(review => review.id === reviewId);
                    
                    if (reviewIndex === -1) {
                        throw new Error(`–û—Ç–∑—ã–≤ —Å ID ${reviewId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                    }
                    
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ä–µ–∞–∫—Ü–∏–∏
                    const currentValue = data.reviews[reviewIndex][reactionType] || 0;
                    data.reviews[reviewIndex][reactionType] = currentValue + 1;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await this.saveData(data);
                    
                    return data.reviews[reviewIndex][reactionType];
                } catch (error) {
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–∏: ${error.message}`, 'error');
                    throw error;
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API
        const api = new SimpleJSONBinAPI(
            "67d39e6a8561e97a50eb9aab", // Bin ID
            "2a$10 U.spgA59NgzW9tOTIHK/QekIr4DVVruFGSAw2vXAx1Uuxz5zPnnSe" // Master Key
        );
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(message, type = 'info') {
            const messageElement = document.getElementById('status-message');
            messageElement.textContent = message;
            messageElement.className = type;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            if (type === 'success') {
                setTimeout(() => {
                    messageElement.textContent = '';
                    messageElement.className = '';
                }, 3000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
        function displayReviews(reviews) {
            const container = document.getElementById('reviews-container');
            container.innerHTML = '';
            
            if (!reviews || reviews.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Ç–∑—ã–≤—ã –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            reviews.sort((a, b) => {
                const dateA = new Date(a.timestamp || a.date || 0);
                const dateB = new Date(b.timestamp || b.date || 0);
                return dateB - dateA;
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∂–¥—ã–π –æ—Ç–∑—ã–≤
            reviews.forEach(review => {
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                let formattedDate = '';
                try {
                    const date = new Date(review.timestamp || review.date);
                    formattedDate = date.toLocaleString();
                } catch (e) {
                    formattedDate = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –¥–∞—Ç–∞';
                }
                
                reviewCard.innerHTML = `
                    <h3>${review.name}</h3>
                    <p><strong>–î–∞—Ç–∞:</strong> ${formattedDate}</p>
                    <p><strong>–û—Ü–µ–Ω–∫–∞:</strong> ${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}</p>
                    <p><strong>–£—Å–ª—É–≥–∞:</strong> ${review.service}</p>
                    <p>${review.text}</p>
                    <div>
                        <button class="like-btn" data-id="${review.id}">üëç –õ–∞–π–∫ (${review.likes || 0})</button>
                        <button class="dislike-btn" data-id="${review.id}">üëé –î–∏–∑–ª–∞–π–∫ (${review.dislikes || 0})</button>
                    </div>
                `;
                
                container.appendChild(reviewCard);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤
            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const reviewId = this.getAttribute('data-id');
                    try {
                        const newCount = await api.updateReaction(reviewId, 'likes');
                        this.textContent = `üëç –õ–∞–π–∫ (${newCount})`;
                        showMessage('–õ–∞–π–∫ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ª–∞–π–∫–∞:', error);
                    }
                });
            });
            
            document.querySelectorAll('.dislike-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const reviewId = this.getAttribute('data-id');
                    try {
                        const newCount = await api.updateReaction(reviewId, 'dislikes');
                        this.textContent = `üëé –î–∏–∑–ª–∞–π–∫ (${newCount})`;
                        showMessage('–î–∏–∑–ª–∞–π–∫ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∏–∑–ª–∞–π–∫–∞:', error);
                    }
                });
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∑—ã–≤–∞
        document.getElementById('review-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const reviewData = {
                name: document.getElementById('name').value,
                rating: parseInt(document.getElementById('rating').value),
                service: document.getElementById('service').value,
                text: document.getElementById('text').value,
                date: new Date().toISOString()
            };
            
            try {
                await api.addReview(reviewData);
                showMessage('–û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                this.reset();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤
                const data = await api.getData();
                displayReviews(data.reviews);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–∑—ã–≤–∞:', error);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤
        document.getElementById('load-reviews').addEventListener('click', async function() {
            try {
                const data = await api.getData();
                displayReviews(data.reviews);
                showMessage('–û—Ç–∑—ã–≤—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∑—ã–≤–æ–≤:', error);
            }
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', async function() {
            try {
                const data = await api.getData();
                displayReviews(data.reviews);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∑—ã–≤–æ–≤:', error);
            }
        });
    </script>
</body>
</html>